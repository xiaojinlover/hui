<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta name="misapplication-tap-highlight" content="no" />
		<meta name="HandheldFriendly" content="true" />
		<link rel="stylesheet" href="dist/css/mui.css">
		<link rel="stylesheet" href="dist/css/style.css">
		<link rel="stylesheet" href="css/iconfont.css">
		<title>慧人事</title>
		<style>
			#pullrefresh {
				padding-bottom: 54px;
			}
			
			#index .mui-content>ul.mui-table-view-chevron li.mui-table-view-cell a#index-header-info::after {
				font-size: 24px;
			}
		</style>
	</head>

	<body id="index">
		<header class="mui-bar mui-bar-nav">
			<h1 id="title" class="mui-title"></h1>
		</header>

		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<div class="mui-content">
					<ul class="mui-table-view mui-table-view-chevron mui-hi">
						<li class="mui-table-view-cell mui-media">
							<a id="index-header-info" class="mui-navigate-right" href="setting-zwxx">
								<img class="mui-media-object mui-pull-left" id="users-head" src="images/test-head.png" />
								<div class="mui-media-body" id="gerenInfo">
									<p class='mui-ellipsis' id="zhi-wei"></p>
								</div>
							</a>
							<a class="mui-btn mui-btn-outlined mui-hidden" href="ruzhi-wdll-grzl" id="li-ji-ru-zhi" style="border: 1px solid rgba(255,255,255,.3);color: #fff;">立即入职</a>
						</li>
					</ul>
					<!--福利券-->
					<!--<div class="score-detail-wrap mui-hidden" id="dai-fa"> 
						<div class="score-detail">  
							<div class="mui-row">
								<div class="mui-col-xs-4"> 
									<a href="score-xjgz">		
										<div class="mui-pull-left"><i class="iconfont icon-icon_xianjin"></i></div>  
										<div class="mui-pull-right"> 
											<span id="xian-jin-gong-zi">0</span>
											<p>现金工资</p>   
										</div>					
									</a> 
								</div>
								<div class="mui-col-xs-4" id="zong-song-ji-fen">
									<a href="score-zsjf"><div class="mui-pull-left"><i class="iconfont icon-icon_keyong"></i></div> 
										<div class="mui-pull-right"> 
											<span id="zeng-song-ji-fen">0</span>
											<p>赠送福利券</p>	  
										</div>			
									</a>
								</div>
								<div class="mui-col-xs-4" id="dai-zong-ji-fen">
									<a href="score-dzjf"><div class="mui-pull-left" ><i class="iconfont icon-icon_daizeng"></i></div>  
										<div class="mui-pull-right"> 
											<span id="dai-zeng-ji-fen">0</span>
											<p>待赠福利券</p>	
										</div>			
									</a>
								</div>								
							</div>
						</div>
					</div>-->
					<!--福利券 end-->

					<!--工资积分-->
					<ul class="mui-table-view mui-grid-view mui-grid-9 score-wrap mui-hidden" id="dai-fa">    
						<li class="mui-col-xs-6 mui-table-view-cell mui-media">
							<a href="score-xjgz">  
								<i class="iconfont icon-icon_xianjin"></i>
								<span id="xian-jin-gong-zi">0.00</span>
								<p>现金工资</p>
							</a>
						</li>
						<li class="mui-col-xs-6 mui-table-view-cell mui-media">
							<a href="score-maifen">
								<i class="iconfont icon-jifen"></i>
								<span id="mai-fen">0.00</span>
								<p>麦分</p>
							</a>
						</li>
						<li class="mui-col-xs-6 mui-table-view-cell mui-media">
							<a href="score-zsjf">
								<i class="iconfont icon-icon_keyong"></i>
								<span id="zeng-song-ji-fen">0.00</span>
								<p>赠送福利券</p>
							</a>
						</li>
						<li class="mui-col-xs-6 mui-table-view-cell mui-media">
							<a href="score-dzjf">
								<i class="iconfont icon-icon_daizeng"></i>
								<span id="dai-zeng-ji-fen">0.00</span>
								<p>待赠福利券</p>
							</a>
						</li>
					</ul>
					<!--工资积分 end-->
					<!--9宫格-->
					<ul class="mui-table-view mui-grid-view mui-grid-9">
						<li class="mui-table-view-cell mui-media mui-col-xs-4">
							<a href="setting-gonggao">
								<img src="images/index-icon-gonggao.png" />
								<div class="mui-media-body">公告</div>
							</a>
						</li>
						<li class="mui-table-view-cell mui-media mui-col-xs-4">
							<a href="setting-gzzd">
								<img src="images/index-icon-gzzd.png" />
								<div class="mui-media-body">制度</div>
							</a>
						</li>
						<li class="mui-table-view-cell mui-media mui-col-xs-4">
							<a href="shop">
								<img src="images/index-icon-shop.png" />
								<div class="mui-media-body">福利商城</div>
							</a>
						</li>
						<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-hidden" id="kuaishebao">
							<a href="http://www.huirenshi.com/Appnew/Social/index">
								<img src="images/index-icon-kuaishebao.png" style="border-radius: 50%;" />
								<div class="mui-media-body">快社保</div> 
							</a>
						</li>
					</ul>
					<!--9宫格 end-->
				</div>
			</div>
		</div>
		<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item mui-active" href="index">
				<span class="mui-icon icon iconfont icon-home1"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item" href="address">
				<span class="mui-icon icon iconfont icon-address"></span>
				<span class="mui-tab-label">通讯录</span>
			</a>
			<a class="mui-tab-item" href="setting">
				<span class="mui-icon icon iconfont icon-setting"></span>
				<span class="mui-tab-label">我的</span> 
			</a>
		</nav>

	</body>
	<script>
		var h5pullDown = true;
	</script>
	<script src="dist/js/mui.js"></script>
	<script src="js/common.js"></script>
	<!--<script src="js/baiduMaps.js"></script> -->
	<!--<script src="js/GeoUtils.js"></script>-->
	<!--<script src="buildNew/index.js"></script>-->
	<script>
		mui.init({
			pullRefresh: {
				container: '#pullrefresh',
				down: {
					callback: pulldownRefresh,
					auto: true
				}
			}
		});

		var getInfo = function getInfo() {} //全局

		//下拉刷新
		function pulldownRefresh() {
			setTimeout(function() {
				var data1 = new getInfo();
				data1.getData();
				mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
			}, 800);
		}

		mui.plusReady(function() {

			if(plus.storage.getItem('token') != null) {
				var login = plus.webview.getWebviewById('login');
				if(login != null)
					login.close();
			}

			//获取首页数 据(全局)
			getInfo.prototype.getData = function() {

				//未入职
				if(plus.storage.getItem('role') == "0") {
					document.getElementById('index-header-info').removeAttribute('class');
					document.getElementById('li-ji-ru-zhi').setAttribute('class', 'mui-btn mui-btn-outlined');
				} else {
					document.getElementById('index-header-info').setAttribute('class', 'mui-navigate-right');
					document.getElementById('li-ji-ru-zhi').setAttribute('class', 'mui-btn mui-btn-outlined mui-hidden');

				}

				document.getElementById('gerenInfo').innerHTML = (plus.storage.getItem("real_name") != null ? plus.storage.getItem("real_name") : "暂无") + '<p class="mui-ellipsis" id="zhi-wei">' + (plus.storage.getItem("zhi_wei") != null ? plus.storage.getItem("zhi_wei") : "暂无") + '</p>';

				//公司名称
				document.getElementById('title').innerHTML = (plus.storage.getItem("companyname") != "" ? plus.storage.getItem("companyname") : "未入职");

				//用户头像
				document.getElementById('users-head').setAttribute('src', plus.storage.getItem('users_image'));

				var getInfoData = {
					"token": plus.storage.getItem("token")
				}

				mui.ajax(apiUrl + 'employee/index', {

					data: getInfoData,
					type: 'post',
					timeout: 10000,
					success: function(data) {

						var data = JSON.parse(data);
						plus.storage.setItem('ruzhi-status', data.detail);
						if(data.detail == '离职')
							document.getElementById('kuaishebao').setAttribute('class', 'mui-table-view-cell mui-media mui-col-xs-4');
						//是否代发
						if(data.data.if_daifa == 1) {
							document.getElementById('dai-fa').className = 'mui-table-view mui-grid-view mui-grid-9 score-wrap';
						}
						//入职状态 
						if(data.detail == "离职") {
							document.getElementById('index-header-info').removeAttribute('class');
							//							document.getElementById('li-ji-ru-zhi').setAttribute('href', 'ruzhi-wdll-grzl');
							document.getElementById('li-ji-ru-zhi').setAttribute('class', 'mui-btn mui-btn-outlined');
							document.getElementById('li-ji-ru-zhi').innerHTML = '立即入职';
						} else if(data.detail == "待入职") {

							document.getElementById('index-header-info').removeAttribute('class');
							document.getElementById('li-ji-ru-zhi').setAttribute('class', 'mui-btn mui-btn-outlined');
							document.getElementById('li-ji-ru-zhi').setAttribute('href', 'ruzhi-wdll-grzl');
							document.getElementById('li-ji-ru-zhi').innerHTML = '入职审核中';
						} else {
							plus.storage.setItem('ruzhi-status', '');
						}

						if(data.status == 1 && data.data != '') {

							plus.storage.setItem('companyname', data.data.company_name);
							plus.storage.setItem('zhi_wei', data.data.zhi_wei);
							plus.storage.setItem("real_name", data.data.real_name);

							//会员头像
							plus.storage.setItem("users_image", data.data.users_image != null ? data.data.users_image : 'images/test-head.png');
							document.getElementById('users-head').setAttribute('src', plus.storage.getItem('users_image'));

							plus.storage.setItem('telephone_key', data.data.telephone_key);

							//缓存登录第三方登录注册信息

							if(data.data.platform) {
								plus.storage.setItem('platform', JSON.stringify(data.data.platform));
								plus.storage.setItem('if_reg', data.data.platform[0].if_reg.toString());
								plus.storage.setItem('user_key', data.data.platform[0].user_key);
							}

							//用户福利券		
							if(data.data.wage_int != null) {
								document.getElementById('xian-jin-gong-zi').innerHTML = data.data.wage_int.have_int_num != null ? data.data.wage_int.have_int_num : '0';
								document.getElementById('zeng-song-ji-fen').innerHTML = data.data.wage_int.already_int != null ? data.data.wage_int.already_int : '0';
								document.getElementById('dai-zeng-ji-fen').innerHTML = data.data.wage_int.stay_back_int != null ? data.data.wage_int.stay_back_int : '0';
							}
						}
						return false;
					},
					beforeSend: function() {
						plus.nativeUI.showWaiting("玩命加载中...", {
							background: 'rgba(0,0,0,0.5)'
						});
					},
					complete: function() {
						plus.nativeUI.closeWaiting();
					},
					error: function(xhr, typeinfo) {
						if(typeinfo == 'abort') {
							mui.alert('连接不到网络，请检查您当前的网络设置');
						} else {
							mui.alert('参数错误' + typeinfo);
						}
					}
				});

			}
			//选项卡  
			mui('.mui-bar-tab').on('tap', 'a', function() {
				var href = this.getAttribute('href');

				if(href == "index" && plus.storage.getItem('if_company') == 1) {
					href = "index-boss";
				} else if(href == "index" && plus.storage.getItem('if_company') != 1) {
					href = "index";
				}

				mui.openWindow({
					url: href + '.html',
					id: href,
					createNew: false,
					show: {
						autoShow: true,
						aniShow: false
					},
					waiting: {
						autoShow: true,
						title: '玩命加载中...'
					},
				})
			})

			//链接
			mui('.mui-table-view,.mui-row').on('tap', 'a', function() {
				var href = this.getAttribute('href');

				if(href == 'setting-zwxx' && plus.storage.getItem('role') == "0") {
					return false;
				}

				if(href == 'shop') {
					if(plus.storage.getItem('if_reg') == '1') {
						href = 'shop';
					} else {
						href = 'authorize-login';
					}

					mui.openWindow({

						url: href + '.html',
						id: href,
						createNew: true,
						show: {
							autoShow: true,
							aniShow: "slide-in-right"

						},
						waiting: {
							autoShow: false,
							title: '玩命加载中...'
						},
					})
					return false;
				}
				mui.openWindow({
					url: href + '.html',
					id: href,
					createNew: true,
					show: {
						autoShow: true,
						aniShow: "slide-in-right"
					},
					waiting: {
						autoShow: false,
						title: '玩命加载中...'
					},

				})
			})

			//跳转BOSS
			if(plus.storage.getItem('if_company') == 1) {

				mui.openWindow({
					url: 'index-boss.html',
					id: 'index-boss',
					createNew: true,
					show: {
						autoShow: true,
						aniShow: "slide-in-right"
					},
					waiting: {
						autoShow: false,
						title: '玩命加载中...'
					},

				})

			}
		})
	</script>

</html>